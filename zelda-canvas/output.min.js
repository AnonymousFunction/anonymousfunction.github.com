var Sound=function(){var isSoundOn=!1,cave=new Audio("sounds/cave.wav"),fanfare=new Audio("sounds/fanfare.wav"),overworld=new Audio("sounds/overworld.mp3"),rupees=new Audio("sounds/text.mp3"),sword=new Audio("sounds/sword.wav"),text=new Audio("sounds/text.mp3");return{cave:{play:function(){isSoundOn&&cave.play()}},fanfare:{play:function(){isSoundOn&&fanfare.play()}},overworld:{play:function(){isSoundOn&&overworld.play()},stop:function(){overworld.pause(),overworld.currentTime=0}},rupees:{play:function(){isSoundOn&&0===rupees.currentTime&&rupees.play()},stop:function(){rupees.pause(),rupees.currentTime=0}},sword:{play:function(){isSoundOn&&sword.play()}},text:{play:function(){isSoundOn&&text.play()}}}}(),CaveMoblin=function(game,center){this.id="red-moblin-down-1",this.game=game,this.size={x:16,y:16},this.center={x:center.x,y:center.y}};CaveMoblin.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){}};var Merchant=function(game,center){this.id="merchant",this.game=game,this.size={x:16,y:16},this.center={x:center.x,y:center.y}};Merchant.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){}};var OldMan=function(game,center){this.id="old-man",this.game=game,this.size={x:16,y:16},this.center={x:center.x,y:center.y}};OldMan.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){}};var RedOctorok=function(game,direction,center){this.id="red-octorok-up-1",this.game=game,this.size={x:14,y:14},this.center={x:center.x,y:center.y},this.tile={},this.spriteChangeCount=0,this.spriteCooldown=8,this.velocity=.4,this.direction=direction,this.changeDirectionCooldown=160,this.changeDirectionCount=0,this.damage=1};RedOctorok.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},kill:function(){this.game.removeBody(this),this.game.addBody(new Cloud(this.game,this.center))},update:function(){if(this.tile.x=parseInt(Number(this.center.x).toFixed(0)/16),this.tile.y=parseInt(Number(this.center.y).toFixed(0)/16),0===this.changeDirectionCount?(this.changeDirectionCount=this.changeDirectionCooldown,this.direction=getRandomDirection(),this.spriteChangeCount=0):this.changeDirectionCount--,0===this.spriteChangeCount?(this.spriteChangeCount=this.spriteCooldown,"up"===this.direction?this.id="red-octorok-up-1"===this.id?"red-octorok-up-2":"red-octorok-up-1":"down"===this.direction?this.id="red-octorok-down-1"===this.id?"red-octorok-down-2":"red-octorok-down-1":"left"===this.direction?this.id="red-octorok-left-1"===this.id?"red-octorok-left-2":"red-octorok-left-1":"right"===this.direction&&(this.id="red-octorok-right-1"===this.id?"red-octorok-right-2":"red-octorok-right-1")):this.spriteChangeCount--,"up"===this.direction){if(this.center.y-this.velocity>this.size.y/2){var newCenterY=this.center.y-this.velocity,newTileY=parseInt(Number(newCenterY).toFixed(0)/16),leftBoundary=this.center.x-4,leftBoundaryTile=parseInt(Number(leftBoundary).toFixed(0)/16),rightBoundary=this.center.x+4,rightBoundaryTile=parseInt(Number(rightBoundary).toFixed(0)/16);if(0===this.game.movementMap[newTileY][leftBoundaryTile]||0===this.game.movementMap[newTileY][rightBoundaryTile])return;this.center.y-=this.velocity}}else if("down"===this.direction){if(this.center.y+this.velocity<this.game.size.y-this.size.y/2){var newCenterY=this.center.y+this.size.y/2+this.velocity,newTileY=parseInt(Number(newCenterY).toFixed(0)/16),leftBoundary=this.center.x-4,leftBoundaryTile=parseInt(Number(leftBoundary).toFixed(0)/16),rightBoundary=this.center.x+4,rightBoundaryTile=parseInt(Number(rightBoundary).toFixed(0)/16);if(this.game.movementMap[newTileY]&&(0===this.game.movementMap[newTileY][leftBoundaryTile]||0===this.game.movementMap[newTileY][rightBoundaryTile]))return;this.center.y+=this.velocity}}else if("left"===this.direction){if(this.center.x-this.velocity>this.size.x/2){var newCenterX=this.center.x-this.size.x/2+this.velocity,newTileX=parseInt(Number(newCenterX).toFixed(0)/16),bottomY=this.center.y+this.size.y/2,bottomTileY=parseInt(Number(bottomY).toFixed(0)/16);if(0===this.game.movementMap[this.tile.y][newTileX]||0===this.game.movementMap[bottomTileY][newTileX])return;this.center.x-=this.velocity}}else if("right"===this.direction&&this.center.x+this.velocity<this.game.size.x-this.size.x/2){var newCenterX=this.center.x+this.size.x/2+this.velocity,newTileX=parseInt(Number(newCenterX).toFixed(0)/16),bottomY=this.center.y+this.size.y/2,bottomTileY=parseInt(Number(bottomY).toFixed(0)/16);if(0===this.game.movementMap[this.tile.y][newTileX]||0===this.game.movementMap[bottomTileY][newTileX])return;this.center.x+=this.velocity}}};var BombExplosion=function(game,center){this.game=game,this.size={x:32,y:32},this.center={x:center.x,y:center.y},this.lifeCountdown=21,this.damage=1};BombExplosion.prototype={draw:function(){},update:function(){0===this.lifeCountdown&&this.game.removeBody(this),this.lifeCountdown--}};var CaveEntrance=function(game,center){this.id="cave-entrance",this.hidden=!0,this.game=game,this.size={x:16,y:2},this.center={x:center.x,y:center.y},this.timer=0};CaveEntrance.prototype={draw:function(screen){if(!this.hidden){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-8)}},isHidden:function(){return this.hidden},show:function(){this.hidden=!1},update:function(){}};var CaveFire=function(game,center){this.id="cave-fire",this.game=game,this.size={x:16,y:16},this.center={x:center.x,y:center.y},this.spriteChangeCount=0,this.spriteCooldown=6};CaveFire.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){0===this.spriteChangeCount?(this.id="cave-fire"===this.id?"cave-fire-1":"cave-fire",this.spriteChangeCount=this.spriteCooldown):this.spriteChangeCount--}};var Cloud=function(game,center){this.id="cloud-1",this.game=game,this.size={x:16,y:16},this.center={x:center.x,y:center.y},this.countdown=21};Cloud.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){0===this.countdown?this.game.removeBody(this):this.countdown<=7?this.id="cloud-3":this.countdown<=14?this.id="cloud-2":this.countdown<=21&&(this.id="cloud-1"),this.countdown--}};var ItemCursor=function(game){this.game=game,this.position=1,this.size={x:16,y:16},this.center={x:137,y:33},this.waitTime=0,this.waitCooldown=15};ItemCursor.prototype={draw:function(screen){var x=this.center.x,y=this.center.y;switch(screen.strokeStyle="#FF0000",screen.strokeRect(x-this.size.x/2,y-this.size.y/2,this.size.x,this.size.y),this.position){case 1:this.center={x:137,y:33};break;case 2:this.center={x:161,y:33};break;case 3:this.center={x:185,y:33};break;case 4:this.center={x:209,y:33};break;case 5:this.center={x:137,y:51};break;case 6:this.center={x:161,y:51};break;case 7:this.center={x:185,y:51};break;case 8:this.center={x:209,y:51}}},update:function(){this.waitTime&&this.waitTime--},moveLeft:function(){this.waitTime||(this.position--,this.position<1&&(this.position=8),this.waitTime=this.waitCooldown)},moveRight:function(){this.waitTime||(this.position++,this.position>8&&(this.position=1),this.waitTime=this.waitCooldown)},selectActive:function(){switch(this.game.player.equippedItem=null,this.position){case 1:this.game.player.equipBoomerang();break;case 2:this.game.player.equipBomb();break;case 3:this.game.player.equippedItem=null;break;case 4:this.game.player.equipBlueCandle();break;case 5:this.game.player.equippedItem=null;break;case 6:this.game.player.equippedItem=null;break;case 7:this.game.player.equippedItem=null;break;case 8:this.game.player.equippedItem=null}}};var ItemPrice=function(game,center){this.id="rupee-one",this.game=game,this.size={x:8,y:16},this.center={x:center.x,y:center.y},this.spriteChangeCount=0,this.spriteCooldown=8};ItemPrice.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2),screen.font="8px 'Press Start 2P'",screen.fillStyle="white",screen.fillText("X",x+6,y+5)},update:function(){0===this.spriteChangeCount?(this.id="rupee-one"===this.id?"rupee-five":"rupee-one",this.spriteChangeCount=this.spriteCooldown):this.spriteChangeCount--}};var SwordEffectTL=function(game,center){this.id="sword-effect-1-tl",this.game=game,this.size={x:8,y:10},this.center={x:center.x,y:center.y},this.lifeCountdown=10,this.velocity=2,this.damage=1};SwordEffectTL.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){0===this.lifeCountdown?this.game.removeBody(this):(this.center.x-=this.velocity,this.center.y-=this.velocity),this.lifeCountdown--,this.id=this.lifeCountdown%2?"sword-effect-1-tl":"sword-effect-2-tl",(this.center.x<0||this.center.x>256||this.center.y<0||this.center.y>176)&&this.game.removeBody(this)}};var SwordEffectTR=function(game,center){this.id="sword-effect-1-tr",this.game=game,this.size={x:8,y:10},this.center={x:center.x,y:center.y},this.lifeCountdown=10,this.velocity=2,this.damage=1};SwordEffectTR.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){0===this.lifeCountdown?this.game.removeBody(this):(this.center.x+=this.velocity,this.center.y-=this.velocity),this.lifeCountdown--,this.id=this.lifeCountdown%2?"sword-effect-1-tr":"sword-effect-2-tr",(this.center.x<0||this.center.x>256||this.center.y<0||this.center.y>176)&&this.game.removeBody(this)}};var SwordEffectBL=function(game,center){this.id="sword-effect-1-bl",this.game=game,this.size={x:8,y:10},this.center={x:center.x,y:center.y},this.lifeCountdown=10,this.velocity=2,this.damage=1};SwordEffectBL.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){0===this.lifeCountdown?this.game.removeBody(this):(this.center.x-=this.velocity,this.center.y+=this.velocity),this.lifeCountdown--,this.id=this.lifeCountdown%2?"sword-effect-1-bl":"sword-effect-2-bl",(this.center.x<0||this.center.x>256||this.center.y<0||this.center.y>176)&&this.game.removeBody(this)}};var SwordEffectBR=function(game,center){this.id="sword-effect-1-br",this.game=game,this.size={x:8,y:10},this.center={x:center.x,y:center.y},this.lifeCountdown=10,this.velocity=2,this.damage=1};SwordEffectBR.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){0===this.lifeCountdown?this.game.removeBody(this):(this.center.x+=this.velocity,this.center.y+=this.velocity),this.lifeCountdown--,this.id=this.lifeCountdown%2?"sword-effect-1-br":"sword-effect-2-br",(this.center.x<0||this.center.x>256||this.center.y<0||this.center.y>176)&&this.game.removeBody(this)}};var createSwordEffect=function(game,center){game.addBody(new SwordEffectTL(game,{x:center.x-2,y:center.y-2})),game.addBody(new SwordEffectTR(game,{x:center.x+2,y:center.y-2})),game.addBody(new SwordEffectBL(game,{x:center.x-2,y:center.y+2})),game.addBody(new SwordEffectBR(game,{x:center.x+2,y:center.y+2}))},Arrow=function(game,player){switch(this.game=game,this.velocity=3,this.center={x:player.center.x,y:player.center.y},this.direction=player.getDirection(),this.direction){case"up":this.id="arrow-up",this.size={x:5,y:16};break;case"down":this.id="arrow-down",this.size={x:5,y:16};break;case"left":this.id="arrow-left",this.size={x:16,y:5};break;case"right":this.id="arrow-right",this.size={x:16,y:5}}};Arrow.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){"up"===this.direction?this.center.y-=this.velocity:"down"===this.direction?this.center.y+=this.velocity:"left"===this.direction?this.center.x-=this.velocity:"right"===this.direction&&(this.center.x+=this.velocity),(this.center.x<0||this.center.x>256||this.center.y<0||this.center.y>176)&&this.game.removeBody(this)}};var BlueCandle=function(game,price,center){this.id="blue-candle",this.price=price,this.game=game,this.size={x:8,y:16},this.center={x:center.x,y:center.y},this.menu={x:128,y:24}};BlueCandle.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2),screen.font="8px 'Press Start 2P'",screen.fillStyle="white",screen.fillText(this.price,x-10,y+20)},update:function(){}};var Bomb=function(game,player){switch(this.id="bomb",this.game=game,this.size={x:8,y:16},this.explodeCountdown=60,player.getDirection()){case"up":this.center={x:player.center.x,y:player.center.y-this.size.y};break;case"down":this.center={x:player.center.x,y:player.center.y+this.size.y};break;case"left":this.center={x:player.center.x-2*this.size.x,y:player.center.y};break;case"right":this.center={x:player.center.x+2*this.size.x,y:player.center.y}}};Bomb.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){this.explodeCountdown--,this.explodeCountdown||(this.game.removeBody(this),createBombExplosion(this.game,this.center))}};var Boomerang=function(game,player){switch(this.game=game,this.id="boomerang",this.velocity=3,this.center={x:player.center.x,y:player.center.y},this.menu={x:129,y:28},this.size={x:5,y:8},this.throwDistance=72,this.rotateAngle=0,this.rotateDelta=18,this.returnToLink=!1,this.direction=player.getDirection(),this.direction){case"up":this.endpoint={x:this.center.x,y:this.center.y-this.throwDistance};break;case"down":this.endpoint={x:this.center.x,y:this.center.y+this.throwDistance};break;case"left":this.endpoint={x:this.center.x-this.throwDistance,y:this.center.y};break;case"right":this.endpoint={x:this.center.x+this.throwDistance,y:this.center.y}}};Boomerang.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.save(),screen.translate(x,y),screen.rotate(this.rotateAngle*Math.PI/180),screen.drawImage(img,-this.size.x/2,-this.size.y/2),screen.restore(),screen.fill()},update:function(){var link=this.game.player;if(this.rotateAngle+=this.rotateDelta,this.returnToLink){if(doBodiesCollide(link,this))return void this.game.removeBody(this);"up"===this.direction||"down"===this.direction?(this.center.x>link.center.x+link.size.x/2?this.center.x-=this.velocity-1:this.center.x<=link.center.x-link.size.x/2&&(this.center.x+=this.velocity-1),this.center.y>link.center.y+link.size.y/2?this.center.y-=this.velocity:this.center.y<=link.center.y-link.size.y/2&&(this.center.y+=this.velocity)):(this.center.x>link.center.x+link.size.x/2?this.center.x-=this.velocity:this.center.x<=link.center.x-link.size.x/2&&(this.center.x+=this.velocity),this.center.y>link.center.y+link.size.y/2?this.center.y-=this.velocity-1:this.center.y<=link.center.y-link.size.y/2&&(this.center.y+=this.velocity-1))}else"up"===this.direction?this.center.y-this.velocity>this.endpoint.y?this.center.y-=this.velocity:this.returnToLink=!0:"down"===this.direction?this.center.y+this.velocity<this.endpoint.y?this.center.y+=this.velocity:this.returnToLink=!0:"left"===this.direction?this.center.x-this.velocity>this.endpoint.x?this.center.x-=this.velocity:this.returnToLink=!0:"right"===this.direction&&(this.center.x+this.velocity<this.endpoint.x?this.center.x+=this.velocity:this.returnToLink=!0);(this.center.x<0||this.center.x>256||this.center.y<0||this.center.y>176)&&(this.returnToLink=!0)}};var CandleFire=function(game,player){switch(this.id="cave-fire",this.game=game,this.size={x:16,y:16},this.spriteChangeCount=0,this.spriteCooldown=10,this.lifeCountdown=180,this.velocity=.6,this.distance=32,this.direction=player.getDirection(),this.direction){case"up":this.center={x:player.center.x,y:player.center.y-this.size.y};break;case"down":this.center={x:player.center.x,y:player.center.y+this.size.y};break;case"left":this.center={x:player.center.x-this.size.x,y:player.center.y};break;case"right":this.center={x:player.center.x+this.size.x,y:player.center.y}}};CandleFire.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){if(0===this.spriteChangeCount?(this.id="cave-fire"===this.id?"cave-fire-1":"cave-fire",this.spriteChangeCount=this.spriteCooldown):this.spriteChangeCount--,this.distance){switch(this.direction){case"up":this.center.y-=this.velocity;break;case"down":this.center.y+=this.velocity;break;case"left":this.center.x-=this.velocity;break;case"right":this.center.x+=this.velocity}this.distance--}this.lifeCountdown--,this.lifeCountdown||this.game.removeBody(this)}};var CaveRupee=function(game,center,value){this.id="rupee-one",this.game=game,this.size={x:8,y:16},this.center={x:center.x,y:center.y},this.spriteChangeCount=0,this.spriteCooldown=8,this.value=value,this.pickedUp=!1};CaveRupee.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2),this.pickedUp&&(screen.font="8px 'Press Start 2P'",screen.fillStyle="white",screen.fillText(this.value,x-15,y+24))},update:function(){0===this.spriteChangeCount?(this.id="rupee-one"===this.id?"rupee-five":"rupee-one",this.spriteChangeCount=this.spriteCooldown):this.spriteChangeCount--},pickup:function(){this.pickedUp=!0}};var EquippedArrow=function(game,center){this.id="arrow-up",this.game=game,this.size={x:5,y:16},this.center={x:center.x,y:center.y},this.menu={x:129,y:25}};EquippedArrow.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){}};var EquippedBomb=function(game,center){this.id="bomb",this.game=game,this.size={x:8,y:16},this.center={x:center.x,y:center.y},this.menu={x:128,y:24}};EquippedBomb.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){}};var KeyItem=function(game,price,center){this.id="key-item",this.price=price,this.game=game,this.size={x:8,y:16},this.center={x:center.x,y:center.y}};KeyItem.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2),screen.font="8px 'Press Start 2P'",screen.fillStyle="white",screen.fillText(this.price,x-10,y+20)},update:function(){}};var MagicShield=function(game,price,center){this.id="magic-shield",this.price=price,this.game=game,this.size={x:8,y:16},this.center={x:center.x,y:center.y}};MagicShield.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2),screen.font="8px 'Press Start 2P'",screen.fillStyle="white",screen.fillText(this.price,x-10,y+20)},update:function(){}};var Sword=function(game,center){this.id="sword-item",this.game=game,this.size={x:7,y:16},this.center={x:center.x,y:center.y}};Sword.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},update:function(){}};var SwordPower=function(game,center,swordDirection){this.game=game,this.spriteChangeCount=0,this.spriteCooldown=6,this.velocity=3,this.center={x:center.x,y:center.y},swordDirection.indexOf("up")>-1?(this.direction="up",this.id="sword-power-up",this.size={x:8,y:16},this.center.x--):swordDirection.indexOf("down")>-1?(this.direction="down",this.id="sword-power-down",this.size={x:8,y:16},this.center.x++):swordDirection.indexOf("left")>-1?(this.direction="left",this.id="sword-power-left",this.size={x:16,y:8},this.center.y++):swordDirection.indexOf("right")>-1&&(this.direction="right",this.id="sword-power-right",this.size={x:16,y:8},this.center.y++)};SwordPower.prototype={draw:function(screen){var x=this.center.x,y=this.center.y,img=document.getElementById(this.id);screen.drawImage(img,x-this.size.x/2,y-this.size.y/2)},remove:function(){this.game.removeBody(this),createSwordEffect(this.game,this.center)},update:function(){0===this.spriteChangeCount?this.spriteChangeCount=this.spriteCooldown:this.spriteChangeCount--,"up"===this.direction?(this.id="sword-power-up"===this.id?"sword-power-up-flash":"sword-power-up",this.center.y-=this.velocity):"down"===this.direction?(this.id="sword-power-down"===this.id?"sword-power-down-flash":"sword-power-down",this.center.y+=this.velocity):"left"===this.direction?(this.id="sword-power-left"===this.id?"sword-power-left-flash":"sword-power-left",this.center.x-=this.velocity):"right"===this.direction&&(this.id="sword-power-right"===this.id?"sword-power-right-flash":"sword-power-right",this.center.x+=this.velocity),(this.center.x<0||this.center.x>256||this.center.y<0||this.center.y>176)&&this.remove()}};